\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{float}%"Плавающие" картинки
\usepackage{wrapfig}%Обтекание фигур (таблиц, картинок и прочего)
\usepackage{amsmath, amssymb, amsthm}
\usepackage[T1, T2A]{fontenc}
\usepackage[english, russian]{babel}
\usepackage[left=1cm,right=1cm, top=1cm, bottom=2cm]{geometry}
% Межстрочный интервал = 1.5pt
\usepackage{setspace}
\onehalfspacing
% % Абзацный отступ = 1.25см
%\usepackage{indentfirst}
%\setlength\parindent{0mm}
% Путь до папки с изображениями
\graphicspath{ {../img/} }
% listings
\usepackage{minted}
% Активные ссылки на формулы и лит-ру
\usepackage[
  colorlinks=true,
  citecolor=blue,
  linkcolor=blue,
  linktoc=page,
]{hyperref}
\usepackage[all]{hypcap}
\usepackage{makecell}

% cleverref
\usepackage{cleveref}
\newcommand{\crefrangeconjunction}{~--~}
\newcommand{\crefpairconjunction}{, }
\newcommand{\creflastconjunction}{, }
\crefname{equation}{}{}

% enumeration
\numberwithin{equation}{section}

\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{cancel}
\usepackage{tcolorbox}
\include{latex_defs}
\include{clisting}
\include{sub3}

\usepackage{tikz}
\usetikzlibrary{calc, arrows.meta, bending, decorations.pathreplacing}
\usepackage{witharrows}

\begin{document}

\newpage
\tableofcontents
\newpage

\begin{equation}
\begin{array}{lrcccl}
\mat M & [ & \frac{h}{6}  & \frac{2 h}{3}  & \frac{h}{6} & ] \\
\mat M_{SUPG} & [ & \frac{1}{2 U} & 0 & -\frac{1}{2 U} & ] \\
\mat K & [ & \frac{U}{2} & 0 & -\frac{U}{2} & ] \\
\mat K_{SUPG} & [ & \frac{1}{h} & -\frac{2}{h} & \frac{1}{h} & ] \\
\end{array}
\end{equation}

\begin{equation}
\left(\mat M + \epsilon \mat M_{SUPG} - \dt \theta \left(\mat K + \epsilon \mat K_{SUPG}\right) \right) \hat u =
\left(\mat M + \epsilon \mat M_{SUPG} + \dt (1 - \theta) \left(\mat K + \epsilon \mat K_{SUPG}\right) \right) u
\end{equation}

\begin{align}
a_{ii} & = \frac{2 h}{3} + \frac{2 \dt \theta \epsilon}{h} \\
a_{i,i-1} & = \frac{h}{6} + \frac{\epsilon}{2 U} - \frac{\dt \theta U}{2} - \frac{\dt \theta \epsilon}{h} \\
a_{i,i+1} & = \frac{h}{6} - \frac{\epsilon}{2 U} + \frac{\dt \theta U}{2} - \frac{\dt \theta \epsilon}{h} \\
b_{ii} & = \frac{2 h}{3} - \frac{2 \dt (1 - \theta) \epsilon}{h} \\
b_{i,i-1} & = \frac{h}{6} + \frac{\epsilon}{2 U} + \frac{\dt (1 - \theta) U}{2} + \frac{\dt (1 - \theta) \epsilon}{h} \\
b_{i,i+1} & = \frac{h}{6} - \frac{\epsilon}{2 U} - \frac{\dt (1 - \theta) U}{2} + \frac{\dt (1 - \theta) \epsilon}{h}
\end{align}

Из условия противопотоковости:
\begin{equation}
\epsilon \geq \frac{U h}{2}
\end{equation}
Пусть
\begin{equation}
\epsilon = \kappa \frac{U h }{2}
\end{equation}

Введём число Куранта
\begin{equation}
C = \frac{U \dt}{h}
\end{equation}

Перепишем:
\begin{align}
a_{ii} & = h\left(\frac{2}{3} + \theta \kappa C\right) \geq 0 \label{eq:fem_supg_theta_cond1}\\
a_{i,i-1} & = \frac{h}{2}\left(\frac{1}{3} + \frac{\kappa}{2} - \theta C - \theta C \kappa \right) \leq 0 \label{eq:fem_supg_theta_cond2}\\
a_{i,i+1} & = \frac{h}{2}\left(\frac{1}{3} - \frac{\kappa}{2} + \theta C - \theta C \kappa \right) \leq 0 \label{eq:fem_supg_theta_cond3}\\
b_{ii} & = h\left(\frac{2}{3} - (1-\theta) C \kappa \right) \geq 0 \label{eq:fem_supg_theta_cond4}\\
b_{i,i-1} & = \frac{h}{2}\left(\frac{1}{3} + \frac{\kappa}{2} + (1-\theta)C + (1-\theta)C \kappa \right) \geq 0 \label{eq:fem_supg_theta_cond5}\\
b_{i,i+1} & = \frac{h}{2}\left(\frac{1}{3} - \frac{\kappa}{2} - (1-\theta)C + (1-\theta)C \kappa \right) \geq 0 \label{eq:fem_supg_theta_cond6}
\end{align}

Условия \cref{eq:fem_supg_theta_cond1,eq:fem_supg_theta_cond5} выполняются всегда.
Неравенства \cref{eq:fem_supg_theta_cond2,eq:fem_supg_theta_cond3} дают условие
\begin{equation}
\label{eq:fem_supg_theta_cond23mod}
\kappa \geq \frac{6\theta C + 2}{6\theta C - 3},
\quad
2\theta C \geq 1
\end{equation}
Из \cref{eq:fem_supg_theta_cond4} следует
\begin{equation}
\kappa \leq \frac{2}{3(1-\theta)C}
\end{equation}
Из \cref{eq:fem_supg_theta_cond6} --
\begin{equation}
\begin{cases}
&\kappa \leq \frac{6 (1 -\theta)C - 2}{6 (1-\theta) C -3}, \quad 3(1-\theta)C \leq 1, \\
&\kappa \geq \frac{6 (1 -\theta)C - 2}{6 (1-\theta) C -3}, \quad 2(1-\theta)C \geq 1
\end{cases}
\end{equation}
У этих неравенств нет решений.

Улучшим свойства матрицы левой части, используя сосредоточенную матрицу масс.
Тогда вместо \cref{eq:fem_supg_theta_cond23mod}
получим
\begin{equation}
\begin{cases}
\frac{2\theta C}{1 + 2\theta C} \leq \kappa \leq \frac{2\theta C}{1 - 2 \theta C}, & \quad 2\theta C \leq 1 \\
\kappa \geq \frac{2\theta C}{1 + 2\theta C}, & \quad 2 \theta C  \geq 1
\end{cases}
\end{equation}


\end{document}
